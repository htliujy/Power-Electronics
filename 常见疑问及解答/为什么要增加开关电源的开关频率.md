# 为什么要增加开关电源的开关频率

这个笔记是用来论证为什么开关频率越高，变压器（电感）体积可以做到越小，主要是从两个方面来论证频率越高，体积越小：a）磁芯饱和；b）磁芯损耗；
<!-- more -->

## 一、磁芯饱和

在这之前需要看我的其他文章《电感饱和度计算》和《磁芯损耗计算》，了解磁芯饱和的概念，对应的算法，以及磁芯损耗相关的原理及其计算。

下面我们以最简单的buck电路为例，见另一篇文章《buck电源有效值电流计算》，buck电路如下图：

<div  align="center">
<img src="./为什么要增加开关电源的开关频率/figure1_buck_current.png" width = "50%" height = "50%" alt="buck电路拓扑" align=center />
</div>

假定我们固定电流纹波率 $$r$$，也就是固定$$\Delta{I_L}$$的大小，改变频率$$f$$，那么我们将会得到如下结论：

$$
\begin{aligned}
L\propto \frac{1}{f} \tag{1.0}
\end{aligned}
$$

简单起见，我们假设（不算MOS管压降，电感电阻导致的压降）:

- 输入电压为$$V_{in}=10V$$;
- 输出电压为$$V_{out}=5V$$；
- 输出电流取$$I_{out}=10A$$；
- 电流纹波率取$$r=1$$,也就是$$\Delta{I_L}=r*I_{out}=10A$$，电感峰值电流$$I_{p}=I_{out}+\Delta{I_L}/2=15A$$，谷值电流$$I_{v}=I_{out}-\Delta{I_L}/2=5A$$

上面的buck电路中，$$T_{on}=T_{off}=\frac{1}{2}*\frac{1}{f}$$那么，电感量$$L$$和开关频率$$f$$的关系为：
$$
{L=\frac{V_{out}T_{off}}{\Delta{I}}=\frac{1}{2}\frac{V_{out}}{\Delta{I}}\frac{1}{f}}
$$

可以看出，电感量的大小与频率成反比，也就是上面说的$$L\propto \frac{1}{f}$$，在《电感饱和度计算》中，我们知道公式$$B_{max} = \frac{LI_{max}}{NA_e}$$，在$$I_{max}$$不变的情况下，令$$B_{max}=B_{sat}$$（$$B_{sat}$$由磁芯材料决定，这是我们应用磁芯材料时，磁芯材料所能达到的最大磁通密度，再大会发生饱和现象，比如PC40的磁芯在100℃时，$$B_{sat}=0.35T$$），有：

$$
{NA_e=\frac{LI_{max}}{B_{sat}}\propto{1/f}}
$$

而且，$$NA_e$$正是由磁芯大小决定的。

- 当电流大小不变，一般认为线径（对应横截面积）大小不变，那么就会有，$$N\propto{A_w}$$，$$A_w$$为磁芯绕线窗口面积；
- 所以$$NA_e \propto A_{w}A_{e}$$

这里就会自然而然引出另一个非常重要的磁性器件选型设计法则——<font face="黑体" color=red size=5>AP法。</font>

对与这个设计法则，书上和网络上有许多解释，如：a）：[讲述AP法计算电源变压器的来龙去脉！](http://www.zhangfeidz.com/bbs/forum.php?mod=viewthread&tid=235)

b）：Pressman的《Switching Power Supply Design 3ed》书中有更详细的描述，见第七章-Transformers and Magnetic Design，重点讲解在7.6.1 The Area Product Figure of Merit.

重要的思想就是找到AP足够大的变压器，其中：

$$
{AP=A_wA_e}
$$

就是我们在选择磁芯骨架并设计变压器（电感）的时候，会先看看磁芯的绕线窗口和磁芯的横截面积的乘积是否满足要求，这绝对不是拍脑门，而是有理论依据的。

根据经验法则，Pressman的《Switching Power Supply Design 3ed》书中强调的是，开关频率高于50kHz，就需要降低磁通密度的大小，因为开关频率高，损耗太大，得降低磁通密度来达到降低损耗的目的。而开关频率小于50kHz，我们基本上就只需要计算最大磁通密度，保证其不要超过磁芯饱和导致电源故障即可。

### 二、磁芯损耗

不同磁芯有不同磁芯的磁芯损耗模型和损耗大小，以下面Pressman的《Switching Power Supply Design 3ed》书中说的铁氧体的磁芯损耗近似公式为例：

<div  align="center">
<img src="./为什么要增加开关电源的开关频率/figure2_Ferrite_core_losses.png" width = "100%" height = "100%" alt="铁氧体磁芯损耗" align=center />
</div>

表达成公式就是：

$$
L_{loss} = \alpha (B_{max})^{2.7}(f)^{1.6} \tag{2.0}
$$

其中：

- $$\alpha$$是一个常量

根据公式1.0，$$L\propto \frac{1}{f}$$，又因为在一样的电流（输入输出电流）下，$$B_{max}\propto L$$得到：$$B_{max} \propto \frac{1}{f} $$，也就是：
$$
\begin{align}
B_{max} = \beta \frac{1}{f} \tag{2.1}
\end{align}
$$

其中：

- $$\beta$$是一个常量

由公式2.0和公式2.1得到：
$$
\begin{aligned}
L_{loss} &= \alpha  (\beta \frac{1}{f})^{2.7}(f)^{1.6}\\
&= \alpha \beta^{2.7} f^{-1.1}\tag{2.2}
\end{aligned}
$$

所以，很容易得到结论，磁芯损耗和开关频率成负相关，开关频率越高，磁芯损耗越小。

对于其他材料的磁芯，磁芯损耗的拟合公式也相差不大，这里不再赘述。

### 三、增大开关频率带来的其他好处及问题

好处：

- 电容容量可以小一些，在一样的纹波要求下；

坏处：

- 开关管<sup>(1)</sup>本身的开关损耗（区别于导通损耗），势必会增加（主要是硬开关拓扑中）；
- 二极管反向恢复时间要求变高，需要更快的反向恢复时间；
- 电路各处的寄生参数（尤其是寄生电容），要求做到更小，这样才能保证开关的损耗不会太高；
- 高$$dV/dt$$导致的EMI问题，导致电源的EMC问题会更严峻；
- 变压器的临近效应，趋肤效应，都会增强，增加损耗，需要使用更细的漆包线，用三明治等绕法来降低这些铜损。

开关频率增加，并不能

## 四、结论

开关频率升高，是可以降低磁性器件感量及体积，降低磁芯损耗。同时还能顺带降低输入输出电容的容量大小，也能实现降低成本和体积的目的。但对于功率半导体器件本身，包括二极管和开关管，其开关损耗势必会增大，就需要降低它们的结电容和提高它们的开关速度来解决（包括二极管的反向恢复时间等）。

注：
（1）无特殊说明，本文中说的开关管指:Si MOSFET，IGBT，GaN HEMT， SiC MOS，功率三极管等；
